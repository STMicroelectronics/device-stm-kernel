From ce0df4f4ce200a14f36252ab699fed54aabe0edd Mon Sep 17 00:00:00 2001
From: Nicolas LOUBOUTIN <nicolas.louboutin@st.com>
Date: Fri, 17 Jul 2020 09:41:11 +0200
Subject: [PATCH 06/13] ARM-stm32mp1-r2-DEVICETREE add-on for Android

Signed-off-by: Nicolas LOUBOUTIN <nicolas.louboutin@st.com>
---
 arch/arm/boot/dts/Makefile                   |   8 +
 arch/arm/boot/dts/stm32mp151.dtsi            |  13 +-
 arch/arm/boot/dts/stm32mp157a-ev1-mb1166.dts | 132 ++++++++++++++++
 arch/arm/boot/dts/stm32mp157a-ev1.dts        |  10 +-
 arch/arm/boot/dts/stm32mp157c-ev1-mb1166.dts | 132 ++++++++++++++++
 arch/arm/boot/dts/stm32mp157c-ev1.dts        |  10 +-
 arch/arm/boot/dts/stm32mp157d-ev1-mb1166.dts | 132 ++++++++++++++++
 arch/arm/boot/dts/stm32mp157d-ev1.dts        |  10 +-
 arch/arm/boot/dts/stm32mp157f-ev1-mb1166.dts | 132 ++++++++++++++++
 arch/arm/boot/dts/stm32mp157f-ev1.dts        |  10 +-
 arch/arm/boot/dts/stm32mp15xx-edx.dtsi       |   5 +
 arch/arm/boot/dts/stm32mp15xx-evx.dtsi       | 156 ++++++++++++++++---
 12 files changed, 714 insertions(+), 36 deletions(-)
 create mode 100644 arch/arm/boot/dts/stm32mp157a-ev1-mb1166.dts
 create mode 100644 arch/arm/boot/dts/stm32mp157c-ev1-mb1166.dts
 create mode 100644 arch/arm/boot/dts/stm32mp157d-ev1-mb1166.dts
 create mode 100644 arch/arm/boot/dts/stm32mp157f-ev1-mb1166.dts

diff --git a/arch/arm/boot/dts/Makefile b/arch/arm/boot/dts/Makefile
index 1c5d5b0278b2..33e64eaa188a 100644
--- a/arch/arm/boot/dts/Makefile
+++ b/arch/arm/boot/dts/Makefile
@@ -26,6 +26,10 @@ DTC_FLAGS_stm32mp157a-ev1 += -@
 DTC_FLAGS_stm32mp157c-ev1 += -@
 DTC_FLAGS_stm32mp157d-ev1 += -@
 DTC_FLAGS_stm32mp157f-ev1 += -@
+DTC_FLAGS_stm32mp157a-ev1-mb1166 += -@
+DTC_FLAGS_stm32mp157c-ev1-mb1166 += -@
+DTC_FLAGS_stm32mp157d-ev1-mb1166 += -@
+DTC_FLAGS_stm32mp157f-ev1-mb1166 += -@
 DTC_FLAGS_stm32mp157c-ev1-a7-examples += -@
 DTC_FLAGS_stm32mp157c-ev1-m4-examples += -@
 DTC_FLAGS_stm32mp157f-ev1-a7-examples += -@
@@ -1036,6 +1040,10 @@ dtb-$(CONFIG_ARCH_STM32) += \
 	stm32mp157c-ev1.dtb \
 	stm32mp157d-ev1.dtb \
 	stm32mp157f-ev1.dtb \
+	stm32mp157a-ev1-mb1166.dtb \
+	stm32mp157c-ev1-mb1166.dtb \
+	stm32mp157d-ev1-mb1166.dtb \
+	stm32mp157f-ev1-mb1166.dtb \
 	stm32mp157c-ev1-a7-examples.dtb \
 	stm32mp157c-ev1-m4-examples.dtb \
 	stm32mp157f-ev1-a7-examples.dtb \
diff --git a/arch/arm/boot/dts/stm32mp151.dtsi b/arch/arm/boot/dts/stm32mp151.dtsi
index f8b515556667..92f32e098195 100644
--- a/arch/arm/boot/dts/stm32mp151.dtsi
+++ b/arch/arm/boot/dts/stm32mp151.dtsi
@@ -176,13 +176,6 @@
 		};
 	};
 
-	reboot {
-		compatible = "syscon-reboot";
-		regmap = <&rcc>;
-		offset = <0x404>;
-		mask = <0x1>;
-	};
-
 	soc {
 		compatible = "simple-bus";
 		#address-cells = <1>;
@@ -1221,9 +1214,9 @@
 			resets = <&rcc USBO_R>;
 			reset-names = "dwc2";
 			interrupts-extended = <&exti 44 IRQ_TYPE_LEVEL_HIGH>;
-			g-rx-fifo-size = <512>;
+			g-rx-fifo-size = <256>;
 			g-np-tx-fifo-size = <32>;
-			g-tx-fifo-size = <256 16 16 16 16 16 16 16>;
+			g-tx-fifo-size = <128 128 128 64 32 32 32 32>;
 			dr_mode = "otg";
 			usb33d-supply = <&usb33>;
 			power-domains = <&pd_core>;
@@ -1818,7 +1811,7 @@
 				offset = <0x150>; /* reg20 */
 				mask = <0xff>;
 				mode-normal = <0>;
-				mode-fastboot = <0x1>;
+				mode-bootloader = <0x1>;
 				mode-recovery = <0x2>;
 				mode-stm32cubeprogrammer = <0x3>;
 				mode-ums_mmc0 = <0x10>;
diff --git a/arch/arm/boot/dts/stm32mp157a-ev1-mb1166.dts b/arch/arm/boot/dts/stm32mp157a-ev1-mb1166.dts
new file mode 100644
index 000000000000..dc63f17330d3
--- /dev/null
+++ b/arch/arm/boot/dts/stm32mp157a-ev1-mb1166.dts
@@ -0,0 +1,132 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR BSD-3-Clause)
+/*
+ * Copyright (C) STMicroelectronics 2019 - All Rights Reserved
+ * Author: Alexandre Torgue <alexandre.torgue@st.com> for STMicroelectronics.
+ */
+/dts-v1/;
+
+#include "stm32mp157a-ed1.dts"
+#include "stm32mp15xx-evx.dtsi"
+#include <dt-bindings/input/input.h>
+#include <dt-bindings/soc/stm32-hdp.h>
+
+/ {
+	model = "STMicroelectronics STM32MP157A eval daughter on eval mother with MB1166 display panel";
+	compatible = "st,stm32mp157a-ev1", "st,stm32mp157a-ed1", "st,stm32mp157";
+
+	chosen {
+		stdout-path = "serial0:115200n8";
+	};
+
+	aliases {
+		serial1 = &usart3;
+		ethernet0 = &ethernet0;
+	};
+};
+
+&cpu0 {
+	clock-frequency = <650000000>;
+};
+
+&cpu1 {
+	clock-frequency = <650000000>;
+};
+
+&dsi {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+
+	ports {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		port@0 {
+			reg = <0>;
+			dsi_in: endpoint {
+				remote-endpoint = <&ltdc_ep0_out>;
+			};
+		};
+
+		port@1 {
+			reg = <1>;
+			dsi_out: endpoint {
+				remote-endpoint = <&dsi_panel_in>;
+			};
+		};
+	};
+
+	panel_dsi: panel-dsi@0 {
+		compatible = "orisetech,otm8009a";
+		reg = <0>;
+		reset-gpios = <&gpiof 15 GPIO_ACTIVE_LOW>;
+		power-supply = <&v3v3>;
+		status = "okay";
+
+		port {
+			dsi_panel_in: endpoint {
+				remote-endpoint = <&dsi_out>;
+			};
+		};
+	};
+};
+
+&ov5640 {
+	rotation = <180>;
+};
+
+&button1 {
+	label = "JoyLeft";
+	linux,code = <KEY_LEFT>;
+};
+
+&button2 {
+	label = "JoyUp";
+	linux,code = <KEY_UP>;
+};
+
+&button3 {
+	label = "JoyDown";
+	linux,code = <KEY_DOWN>;
+};
+
+&button4 {
+	label = "JoyRight";
+	linux,code = <KEY_RIGHT>;
+};
+
+&i2c2 {
+	touchscreen@2a {
+		compatible = "focaltech,ft6236";
+		reg = <0x2a>;
+		interrupts = <14 2>;
+		interrupt-parent = <&stmfx_pinctrl>;
+		interrupt-controller;
+		touchscreen-size-x = <480>;
+		touchscreen-size-y = <800>;
+		pinctrl-0 = <&touchscreen_pins>;
+		pinctrl-names = "default";
+		panel = <&panel_dsi>;
+		status = "okay";
+	};
+	touchscreen@38 {
+		compatible = "focaltech,ft6236";
+		reg = <0x38>;
+		interrupts = <14 2>;
+		interrupt-parent = <&stmfx_pinctrl>;
+		interrupt-controller;
+		touchscreen-size-x = <480>;
+		touchscreen-size-y = <800>;
+		pinctrl-0 = <&touchscreen_pins>;
+		pinctrl-names = "default";
+		panel = <&panel_dsi>;
+		status = "okay";
+	};
+};
+
+&m_can1 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&m_can1_pins_a>;
+	pinctrl-1 = <&m_can1_sleep_pins_a>;
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/stm32mp157a-ev1.dts b/arch/arm/boot/dts/stm32mp157a-ev1.dts
index 29ecd15c3216..2b5c26bef77d 100644
--- a/arch/arm/boot/dts/stm32mp157a-ev1.dts
+++ b/arch/arm/boot/dts/stm32mp157a-ev1.dts
@@ -24,6 +24,14 @@
 	};
 };
 
+&cpu0 {
+	clock-frequency = <650000000>;
+};
+
+&cpu1 {
+	clock-frequency = <650000000>;
+};
+
 &dsi {
 	#address-cells = <1>;
 	#size-cells = <0>;
@@ -69,7 +77,7 @@
 		compatible = "goodix,gt9147";
 		reg = <0x5d>;
 		panel = <&panel_dsi>;
-		pinctrl-0 = <&goodix_pins>;
+		pinctrl-0 = <&touchscreen_pins>;
 		pinctrl-names = "default";
 		status = "okay";
 
diff --git a/arch/arm/boot/dts/stm32mp157c-ev1-mb1166.dts b/arch/arm/boot/dts/stm32mp157c-ev1-mb1166.dts
new file mode 100644
index 000000000000..5364318841fa
--- /dev/null
+++ b/arch/arm/boot/dts/stm32mp157c-ev1-mb1166.dts
@@ -0,0 +1,132 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR BSD-3-Clause)
+/*
+ * Copyright (C) STMicroelectronics 2019 - All Rights Reserved
+ * Author: Alexandre Torgue <alexandre.torgue@st.com> for STMicroelectronics.
+ */
+/dts-v1/;
+
+#include "stm32mp157c-ed1.dts"
+#include "stm32mp15xx-evx.dtsi"
+#include <dt-bindings/input/input.h>
+#include <dt-bindings/soc/stm32-hdp.h>
+
+/ {
+	model = "STMicroelectronics STM32MP157C eval daughter on eval mother with MB1166 display panel";
+	compatible = "st,stm32mp157c-ev1", "st,stm32mp157c-ed1", "st,stm32mp157";
+
+	chosen {
+		stdout-path = "serial0:115200n8";
+	};
+
+	aliases {
+		serial1 = &usart3;
+		ethernet0 = &ethernet0;
+	};
+};
+
+&cpu0 {
+	clock-frequency = <650000000>;
+};
+
+&cpu1 {
+	clock-frequency = <650000000>;
+};
+
+&dsi {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+
+	ports {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		port@0 {
+			reg = <0>;
+			dsi_in: endpoint {
+				remote-endpoint = <&ltdc_ep0_out>;
+			};
+		};
+
+		port@1 {
+			reg = <1>;
+			dsi_out: endpoint {
+				remote-endpoint = <&dsi_panel_in>;
+			};
+		};
+	};
+
+	panel_dsi: panel-dsi@0 {
+		compatible = "orisetech,otm8009a";
+		reg = <0>;
+		reset-gpios = <&gpiof 15 GPIO_ACTIVE_LOW>;
+		power-supply = <&v3v3>;
+		status = "okay";
+
+		port {
+			dsi_panel_in: endpoint {
+				remote-endpoint = <&dsi_out>;
+			};
+		};
+	};
+};
+
+&ov5640 {
+	rotation = <180>;
+};
+
+&button1 {
+	label = "JoyLeft";
+	linux,code = <KEY_LEFT>;
+};
+
+&button2 {
+	label = "JoyUp";
+	linux,code = <KEY_UP>;
+};
+
+&button3 {
+	label = "JoyDown";
+	linux,code = <KEY_DOWN>;
+};
+
+&button4 {
+	label = "JoyRight";
+	linux,code = <KEY_RIGHT>;
+};
+
+&i2c2 {
+	touchscreen@2a {
+		compatible = "focaltech,ft6236";
+		reg = <0x2a>;
+		interrupts = <14 2>;
+		interrupt-parent = <&stmfx_pinctrl>;
+		interrupt-controller;
+		touchscreen-size-x = <480>;
+		touchscreen-size-y = <800>;
+		pinctrl-0 = <&touchscreen_pins>;
+		pinctrl-names = "default";
+		panel = <&panel_dsi>;
+		status = "okay";
+	};
+	touchscreen@38 {
+		compatible = "focaltech,ft6236";
+		reg = <0x38>;
+		interrupts = <14 2>;
+		interrupt-parent = <&stmfx_pinctrl>;
+		interrupt-controller;
+		touchscreen-size-x = <480>;
+		touchscreen-size-y = <800>;
+		pinctrl-0 = <&touchscreen_pins>;
+		pinctrl-names = "default";
+		panel = <&panel_dsi>;
+		status = "okay";
+	};
+};
+
+&m_can1 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&m_can1_pins_a>;
+	pinctrl-1 = <&m_can1_sleep_pins_a>;
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/stm32mp157c-ev1.dts b/arch/arm/boot/dts/stm32mp157c-ev1.dts
index c60727d9b1ae..40ad7e79c73b 100644
--- a/arch/arm/boot/dts/stm32mp157c-ev1.dts
+++ b/arch/arm/boot/dts/stm32mp157c-ev1.dts
@@ -24,6 +24,14 @@
 	};
 };
 
+&cpu0 {
+	clock-frequency = <650000000>;
+};
+
+&cpu1 {
+	clock-frequency = <650000000>;
+};
+
 &dsi {
 	#address-cells = <1>;
 	#size-cells = <0>;
@@ -69,7 +77,7 @@
 		compatible = "goodix,gt9147";
 		reg = <0x5d>;
 		panel = <&panel_dsi>;
-		pinctrl-0 = <&goodix_pins>;
+		pinctrl-0 = <&touchscreen_pins>;
 		pinctrl-names = "default";
 		status = "okay";
 
diff --git a/arch/arm/boot/dts/stm32mp157d-ev1-mb1166.dts b/arch/arm/boot/dts/stm32mp157d-ev1-mb1166.dts
new file mode 100644
index 000000000000..1a23ed611aab
--- /dev/null
+++ b/arch/arm/boot/dts/stm32mp157d-ev1-mb1166.dts
@@ -0,0 +1,132 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR BSD-3-Clause)
+/*
+ * Copyright (C) STMicroelectronics 2019 - All Rights Reserved
+ * Author: Alexandre Torgue <alexandre.torgue@st.com> for STMicroelectronics.
+ */
+/dts-v1/;
+
+#include "stm32mp157d-ed1.dts"
+#include "stm32mp15xx-evx.dtsi"
+#include <dt-bindings/input/input.h>
+#include <dt-bindings/soc/stm32-hdp.h>
+
+/ {
+	model = "STMicroelectronics STM32MP157D eval daughter on eval mother with MB1166 display panel";
+	compatible = "st,stm32mp157d-ev1", "st,stm32mp157d-ed1", "st,stm32mp157";
+
+	chosen {
+		stdout-path = "serial0:115200n8";
+	};
+
+	aliases {
+		serial1 = &usart3;
+		ethernet0 = &ethernet0;
+	};
+};
+
+&cpu0 {
+	clock-frequency = <800000000>;
+};
+
+&cpu1 {
+	clock-frequency = <800000000>;
+};
+
+&dsi {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+
+	ports {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		port@0 {
+			reg = <0>;
+			dsi_in: endpoint {
+				remote-endpoint = <&ltdc_ep0_out>;
+			};
+		};
+
+		port@1 {
+			reg = <1>;
+			dsi_out: endpoint {
+				remote-endpoint = <&dsi_panel_in>;
+			};
+		};
+	};
+
+	panel_dsi: panel-dsi@0 {
+		compatible = "orisetech,otm8009a";
+		reg = <0>;
+		reset-gpios = <&gpiof 15 GPIO_ACTIVE_LOW>;
+		power-supply = <&v3v3>;
+		status = "okay";
+
+		port {
+			dsi_panel_in: endpoint {
+				remote-endpoint = <&dsi_out>;
+			};
+		};
+	};
+};
+
+&ov5640 {
+	rotation = <180>;
+};
+
+&button1 {
+	label = "JoyLeft";
+	linux,code = <KEY_LEFT>;
+};
+
+&button2 {
+	label = "JoyUp";
+	linux,code = <KEY_UP>;
+};
+
+&button3 {
+	label = "JoyDown";
+	linux,code = <KEY_DOWN>;
+};
+
+&button4 {
+	label = "JoyRight";
+	linux,code = <KEY_RIGHT>;
+};
+
+&i2c2 {
+	touchscreen@2a {
+		compatible = "focaltech,ft6236";
+		reg = <0x2a>;
+		interrupts = <14 2>;
+		interrupt-parent = <&stmfx_pinctrl>;
+		interrupt-controller;
+		touchscreen-size-x = <480>;
+		touchscreen-size-y = <800>;
+		pinctrl-0 = <&touchscreen_pins>;
+		pinctrl-names = "default";
+		panel = <&panel_dsi>;
+		status = "okay";
+	};
+	touchscreen@38 {
+		compatible = "focaltech,ft6236";
+		reg = <0x38>;
+		interrupts = <14 2>;
+		interrupt-parent = <&stmfx_pinctrl>;
+		interrupt-controller;
+		touchscreen-size-x = <480>;
+		touchscreen-size-y = <800>;
+		pinctrl-0 = <&touchscreen_pins>;
+		pinctrl-names = "default";
+		panel = <&panel_dsi>;
+		status = "okay";
+	};
+};
+
+&m_can1 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&m_can1_pins_a>;
+	pinctrl-1 = <&m_can1_sleep_pins_a>;
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/stm32mp157d-ev1.dts b/arch/arm/boot/dts/stm32mp157d-ev1.dts
index a4752c100ef9..1e05fb36b61c 100644
--- a/arch/arm/boot/dts/stm32mp157d-ev1.dts
+++ b/arch/arm/boot/dts/stm32mp157d-ev1.dts
@@ -24,6 +24,14 @@
 	};
 };
 
+&cpu0 {
+	clock-frequency = <800000000>;
+};
+
+&cpu1 {
+	clock-frequency = <800000000>;
+};
+
 &dsi {
 	#address-cells = <1>;
 	#size-cells = <0>;
@@ -69,7 +77,7 @@
 		compatible = "goodix,gt9147";
 		reg = <0x5d>;
 		panel = <&panel_dsi>;
-		pinctrl-0 = <&goodix_pins>;
+		pinctrl-0 = <&touchscreen_pins>;
 		pinctrl-names = "default";
 		status = "okay";
 
diff --git a/arch/arm/boot/dts/stm32mp157f-ev1-mb1166.dts b/arch/arm/boot/dts/stm32mp157f-ev1-mb1166.dts
new file mode 100644
index 000000000000..a20760a3acda
--- /dev/null
+++ b/arch/arm/boot/dts/stm32mp157f-ev1-mb1166.dts
@@ -0,0 +1,132 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR BSD-3-Clause)
+/*
+ * Copyright (C) STMicroelectronics 2019 - All Rights Reserved
+ * Author: Alexandre Torgue <alexandre.torgue@st.com> for STMicroelectronics.
+ */
+/dts-v1/;
+
+#include "stm32mp157f-ed1.dts"
+#include "stm32mp15xx-evx.dtsi"
+#include <dt-bindings/input/input.h>
+#include <dt-bindings/soc/stm32-hdp.h>
+
+/ {
+	model = "STMicroelectronics STM32MP157F eval daughter on eval mother with MB1166 display panel";
+	compatible = "st,stm32mp157f-ev1", "st,stm32mp157f-ed1", "st,stm32mp157";
+
+	chosen {
+		stdout-path = "serial0:115200n8";
+	};
+
+	aliases {
+		serial1 = &usart3;
+		ethernet0 = &ethernet0;
+	};
+};
+
+&cpu0 {
+	clock-frequency = <800000000>;
+};
+
+&cpu1 {
+	clock-frequency = <800000000>;
+};
+
+&dsi {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+
+	ports {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		port@0 {
+			reg = <0>;
+			dsi_in: endpoint {
+				remote-endpoint = <&ltdc_ep0_out>;
+			};
+		};
+
+		port@1 {
+			reg = <1>;
+			dsi_out: endpoint {
+				remote-endpoint = <&dsi_panel_in>;
+			};
+		};
+	};
+
+	panel_dsi: panel-dsi@0 {
+		compatible = "orisetech,otm8009a";
+		reg = <0>;
+		reset-gpios = <&gpiof 15 GPIO_ACTIVE_LOW>;
+		power-supply = <&v3v3>;
+		status = "okay";
+
+		port {
+			dsi_panel_in: endpoint {
+				remote-endpoint = <&dsi_out>;
+			};
+		};
+	};
+};
+
+&ov5640 {
+	rotation = <180>;
+};
+
+&button1 {
+	label = "JoyLeft";
+	linux,code = <KEY_LEFT>;
+};
+
+&button2 {
+	label = "JoyUp";
+	linux,code = <KEY_UP>;
+};
+
+&button3 {
+	label = "JoyDown";
+	linux,code = <KEY_DOWN>;
+};
+
+&button4 {
+	label = "JoyRight";
+	linux,code = <KEY_RIGHT>;
+};
+
+&i2c2 {
+	touchscreen@2a {
+		compatible = "focaltech,ft6236";
+		reg = <0x2a>;
+		interrupts = <14 2>;
+		interrupt-parent = <&stmfx_pinctrl>;
+		interrupt-controller;
+		touchscreen-size-x = <480>;
+		touchscreen-size-y = <800>;
+		pinctrl-0 = <&touchscreen_pins>;
+		pinctrl-names = "default";
+		panel = <&panel_dsi>;
+		status = "okay";
+	};
+	touchscreen@38 {
+		compatible = "focaltech,ft6236";
+		reg = <0x38>;
+		interrupts = <14 2>;
+		interrupt-parent = <&stmfx_pinctrl>;
+		interrupt-controller;
+		touchscreen-size-x = <480>;
+		touchscreen-size-y = <800>;
+		pinctrl-0 = <&touchscreen_pins>;
+		pinctrl-names = "default";
+		panel = <&panel_dsi>;
+		status = "okay";
+	};
+};
+
+&m_can1 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&m_can1_pins_a>;
+	pinctrl-1 = <&m_can1_sleep_pins_a>;
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/stm32mp157f-ev1.dts b/arch/arm/boot/dts/stm32mp157f-ev1.dts
index 0c18333c07cf..58ea0feba3fe 100644
--- a/arch/arm/boot/dts/stm32mp157f-ev1.dts
+++ b/arch/arm/boot/dts/stm32mp157f-ev1.dts
@@ -24,6 +24,14 @@
 	};
 };
 
+&cpu0 {
+	clock-frequency = <800000000>;
+};
+
+&cpu1 {
+	clock-frequency = <800000000>;
+};
+
 &dsi {
 	#address-cells = <1>;
 	#size-cells = <0>;
@@ -69,7 +77,7 @@
 		compatible = "goodix,gt9147";
 		reg = <0x5d>;
 		panel = <&panel_dsi>;
-		pinctrl-0 = <&goodix_pins>;
+		pinctrl-0 = <&touchscreen_pins>;
 		pinctrl-names = "default";
 		status = "okay";
 
diff --git a/arch/arm/boot/dts/stm32mp15xx-edx.dtsi b/arch/arm/boot/dts/stm32mp15xx-edx.dtsi
index 0c57a9607454..71474c111eb8 100644
--- a/arch/arm/boot/dts/stm32mp15xx-edx.dtsi
+++ b/arch/arm/boot/dts/stm32mp15xx-edx.dtsi
@@ -57,6 +57,11 @@
 
 	led {
 		compatible = "gpio-leds";
+		red {
+			label = "red";
+			gpios = <&gpioa 13 GPIO_ACTIVE_LOW>;
+			default-state = "off";
+		};
 		blue {
 			label = "heartbeat";
 			gpios = <&gpiod 9 GPIO_ACTIVE_HIGH>;
diff --git a/arch/arm/boot/dts/stm32mp15xx-evx.dtsi b/arch/arm/boot/dts/stm32mp15xx-evx.dtsi
index 1a2b49cadac2..6722e060d0b7 100644
--- a/arch/arm/boot/dts/stm32mp15xx-evx.dtsi
+++ b/arch/arm/boot/dts/stm32mp15xx-evx.dtsi
@@ -21,33 +21,33 @@
 		#size-cells = <0>;
 		pinctrl-0 = <&joystick_pins>;
 		pinctrl-names = "default";
-		button-0 {
+		button0: button-0 {
 			label = "JoySel";
 			linux,code = <KEY_ENTER>;
 			interrupt-parent = <&stmfx_pinctrl>;
 			interrupts = <0 IRQ_TYPE_EDGE_RISING>;
 		};
-		button-1 {
-			label = "JoyDown";
-			linux,code = <KEY_DOWN>;
+		button1: button-1 {
+			label = "JoyRight";
+			linux,code = <KEY_RIGHT>;
 			interrupt-parent = <&stmfx_pinctrl>;
 			interrupts = <1 IRQ_TYPE_EDGE_RISING>;
 		};
-		button-2 {
-			label = "JoyLeft";
-			linux,code = <KEY_LEFT>;
+		button2: button-2 {
+			label = "JoyDown";
+			linux,code = <KEY_DOWN>;
 			interrupt-parent = <&stmfx_pinctrl>;
 			interrupts = <2 IRQ_TYPE_EDGE_RISING>;
 		};
-		button-3 {
-			label = "JoyRight";
-			linux,code = <KEY_RIGHT>;
+		button3: button-3 {
+			label = "JoyUp";
+			linux,code = <KEY_UP>;
 			interrupt-parent = <&stmfx_pinctrl>;
 			interrupts = <3 IRQ_TYPE_EDGE_RISING>;
 		};
-		button-4 {
-			label = "JoyUp";
-			linux,code = <KEY_UP>;
+		button4: button-4 {
+			label = "JoyLeft";
+			linux,code = <KEY_LEFT>;
 			interrupt-parent = <&stmfx_pinctrl>;
 			interrupts = <4 IRQ_TYPE_EDGE_RISING>;
 		};
@@ -93,7 +93,7 @@
 			"IN1LN" , "MICBIAS2",
 			"DMIC2DAT" , "MICBIAS1",
 			"DMIC1DAT" , "MICBIAS1";
-		dais = <&sai2a_port &sai2b_port &sai4a_port &spdifrx_port
+		dais = <&sai2a_port &sai2b_port
 			&dfsdm0_port &dfsdm1_port &dfsdm2_port &dfsdm3_port>;
 		status = "okay";
 	};
@@ -162,10 +162,18 @@
 	};
 };
 
+&adc {
+	status = "disabled";
+};
+
+&dac {
+	status = "disabled";
+};
+
 &cec {
 	pinctrl-names = "default";
 	pinctrl-0 = <&cec_pins_a>;
-	status = "okay";
+	status = "disabled";
 };
 
 &dcmi {
@@ -186,6 +194,15 @@
 	};
 };
 
+&dma2 {
+	status = "disabled";
+};
+
+&dmamux1 {
+	dma-masters = <&dma1>;
+	dma-channels = <8>;
+};
+
 &dfsdm {
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&dfsdm_clkout_pins_a
@@ -403,7 +420,7 @@
 		DOVDD-supply = <&v2v8>;
 		powerdown-gpios = <&stmfx_pinctrl 18 (GPIO_ACTIVE_HIGH | GPIO_PUSH_PULL)>;
 		reset-gpios = <&stmfx_pinctrl 19 (GPIO_ACTIVE_LOW | GPIO_PUSH_PULL)>;
-		rotation = <180>;
+		rotation = <0>;
 		status = "okay";
 
 		port {
@@ -434,7 +451,7 @@
 			#interrupt-cells = <2>;
 			gpio-ranges = <&stmfx_pinctrl 0 0 24>;
 
-			goodix_pins: goodix {
+			touchscreen_pins: touchscreen {
 				pins = "gpio14";
 				bias-pull-down;
 			};
@@ -465,7 +482,7 @@
 	i2c-scl-falling-time-ns = <20>;
 	/delete-property/dmas;
 	/delete-property/dma-names;
-	status = "okay";
+	status = "disabled";
 };
 
 &ltdc {
@@ -482,6 +499,101 @@
 	};
 };
 
+&m4_adc {
+	vref-supply = <&vdda>;
+	status = "okay";
+};
+
+&m4_crc2 {
+	status = "okay";
+};
+
+&m4_cryp2 {
+	status = "okay";
+};
+
+&m4_dac {
+	vref-supply = <&vdda>;
+	status = "okay";
+};
+
+&m4_dma2 {
+	status = "okay";
+};
+
+&m4_hash2 {
+	status = "okay";
+};
+
+&m4_i2c5 {
+	pinctrl-names = "rproc_default";
+	pinctrl-0 = <&i2c5_pins_a>;
+	status = "okay";
+};
+
+&m4_qspi {
+	pinctrl-names = "default";
+	pinctrl-0 = <&m4_qspi_clk_pins_a &m4_qspi_bk1_pins_a
+		     &m4_qspi_bk2_pins_a>;
+	status = "okay";
+};
+
+&m4_rproc {
+	m4_system_resources {
+		status = "okay";
+
+	/*	button {
+			compatible = "rproc-srm-dev";
+			interrupt-parent = <&gpioa>;
+			interrupts = <14 2>;
+			interrupt-names = "irq";
+			status = "okay";
+		};*/
+
+		m4_led: m4_led {
+			compatible = "rproc-srm-dev";
+			pinctrl-names = "default";
+			pinctrl-0 = <&m4_leds_orange_pins>;
+			status = "okay";
+		};
+	};
+};
+
+&m4_rng2 {
+	status = "okay";
+};
+
+&m4_spi1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&m4_spi1_pins_a>;
+	status = "okay";
+};
+
+&m4_timers2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&m4_pwm2_pins_a>;
+	status = "okay";
+};
+
+&m4_timers7 {
+	pinctrl-names = "default";
+	status = "okay";
+};
+
+&m4_usart3 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&m4_usart3_pins_a>;
+	status = "okay";
+};
+
+&pinctrl {
+	m4_leds_orange_pins: m4-leds-orange-0 {
+		pins {
+			pinmux = <STM32_PINMUX('D', 8, RSVD)>;
+		};
+	};
+};
+
 &qspi {
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&qspi_clk_pins_a &qspi_bk1_pins_a &qspi_bk2_pins_a>;
@@ -489,7 +601,7 @@
 	reg = <0x58003000 0x1000>, <0x70000000 0x4000000>;
 	#address-cells = <1>;
 	#size-cells = <0>;
-	status = "okay";
+	status = "disabled";
 
 	flash0: mx66l51235l@0 {
 		compatible = "jedec,spi-nor";
@@ -553,7 +665,7 @@
 &sai4 {
 	clocks = <&rcc SAI4>, <&rcc PLL3_Q>, <&rcc PLL3_R>;
 	clock-names = "pclk", "x8k", "x11k";
-	status = "okay";
+	status = "disabled";
 
 	sai4a: audio-controller@50027004 {
 		pinctrl-names = "default", "sleep";
@@ -563,7 +675,7 @@
 		clocks = <&rcc SAI4_K>;
 		clock-names = "sai_ck";
 		st,iec60958;
-		status = "okay";
+		status = "disabled";
 
 		sai4a_port: port {
 			sai4a_endpoint: endpoint {
@@ -589,7 +701,7 @@
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&spdifrx_pins_a>;
 	pinctrl-1 = <&spdifrx_sleep_pins_a>;
-	status = "okay";
+	status = "disabled";
 
 	spdifrx_port: port {
 		spdifrx_endpoint: endpoint {
-- 
2.17.1

